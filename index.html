import React, { useState, useEffect } from 'react';
import { motion } from 'framer-motion';

const FlowerPetal = ({ rotation, color }) => (
  <motion.div
    style={{
      width: '20px',
      height: '30px',
      backgroundColor: color,
      borderRadius: '50% 50% 50% 50% / 60% 60% 40% 40%',
      position: 'absolute',
      top: '-15px',
      left: '-10px',
      transformOrigin: 'bottom center',
      transform: `rotate(${rotation}deg)`,
    }}
  />
);

const Flower = ({ color, size, onClick, animate }) => (
  <motion.div
    style={{ width: size, height: size, position: 'relative' }}
    animate={animate}
    onClick={onClick}
  >
    {[0, 60, 120, 180, 240, 300].map((rotation) => (
      <FlowerPetal key={rotation} rotation={rotation} color={color} />
    ))}
    <motion.div
      style={{
        width: size / 3,
        height: size / 3,
        borderRadius: '50%',
        backgroundColor: 'yellow',
        position: 'absolute',
        top: '50%',
        left: '50%',
        transform: 'translate(-50%, -50%)',
      }}
    />
  </motion.div>
);

const FlowerGame = () => {
  const [flowers, setFlowers] = useState([]);
  const [innerFlowers, setInnerFlowers] = useState([]);
  const colors = ['#FF6B6B', '#4ECDC4', '#45B7D1', '#F7DB4F', '#9B59B6', '#FF8C00'];
  const [gameSize, setGameSize] = useState(300);

  useEffect(() => {
    const initialFlowers = colors.map((color, index) => ({
      id: index,
      color,
      angle: (index / colors.length) * 2 * Math.PI,
      size: 40,
      clickCount: 0,
    }));
    setFlowers(initialFlowers);
  }, []);

  const handleFlowerClick = (clickedFlower) => {
    if (clickedFlower.clickCount === 0) {
      // First click: Bounce off and return
      setFlowers((prevFlowers) =>
        prevFlowers.map((flower) =>
          flower.id === clickedFlower.id
            ? { ...flower, clickCount: 1 }
            : flower
        )
      );
    } else {
      // Second click: Move to inner circle
      setFlowers((prevFlowers) =>
        prevFlowers.filter((flower) => flower.id !== clickedFlower.id)
      );
      setInnerFlowers((prevInnerFlowers) => [
        ...prevInnerFlowers,
        { ...clickedFlower, size: clickedFlower.size * 0.8 },
      ]);
      setGameSize((prevSize) => prevSize * 0.98);
    }
  };

  return (
    <div className="relative" style={{ width: gameSize, height: gameSize }}>
      {flowers.map((flower) => (
        <motion.div
          key={flower.id}
          className="absolute"
          style={{
            left: `${50 + 45 * Math.cos(flower.angle)}%`,
            top: `${50 + 45 * Math.sin(flower.angle)}%`,
          }}
          animate={flower.clickCount === 1 ? {
            x: [0, -20, 20, 0],
            y: [0, -20, 20, 0],
          } : {}}
          transition={{ duration: 0.5, ease: "easeInOut" }}
        >
          <Flower
            color={flower.color}
            size={flower.size}
            onClick={() => handleFlowerClick(flower)}
          />
        </motion.div>
      ))}
      {innerFlowers.map((flower, index) => (
        <motion.div
          key={flower.id}
          className="absolute"
          initial={{ scale: 0 }}
          animate={{
            scale: 1,
            left: `${50 + (index / innerFlowers.length) * 30 * Math.cos((index / innerFlowers.length) * 2 * Math.PI)}%`,
            top: `${50 + (index / innerFlowers.length) * 30 * Math.sin((index / innerFlowers.length) * 2 * Math.PI)}%`,
          }}
          transition={{ duration: 0.5 }}
        >
          <Flower color={flower.color} size={flower.size} />
        </motion.div>
      ))}
    </div>
  );
};

export default FlowerGame;
